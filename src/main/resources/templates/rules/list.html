<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/default :: layout(~{::title}, ~{::section})}">
<head>
    <title>Rules - Gamification System</title>
</head>
<body>
<section>
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Available Rules</h2>
            <a href="/rules/create" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Create New Rule
            </a>
        </div>

        <div class="alert alert-info">
            <p>Select a rule to execute from the list below. Each rule has different effects on points for persons and
                groups.</p>
        </div>

        <div class="row">
            <!-- Dynamically generate cards for each rule -->
            <div th:each="rule : ${rules}" class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-header"
                         th:with="hasAward=${rule.outcomes.?[type == 'award'].size() > 0}, 
                                 hasPenalty=${rule.outcomes.?[type == 'penalty'].size() > 0}"
                         th:classappend="${hasAward && hasPenalty ? 'bg-warning' : (hasAward ? 'bg-success' : 'bg-danger')} + ' text-white'">
                        <h5 class="card-title mb-0" th:text="${rule.ruleName}">Rule Name</h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text" th:text="${rule.description}">Rule description</p>
                        <p><strong>Effect:</strong></p>

                        <!-- Display all award outcomes -->
                        <div th:each="outcome : ${rule.outcomes}" th:if="${outcome.type == 'award'}" class="mb-2">
                            <span class="badge bg-success">Award</span>
                            +<span th:text="${outcome.points}">0</span> points to the
                            <span th:text="${outcome.target != null ? outcome.target : 'participant'}">target</span>'s
                            group.
                            <span th:if="${outcome.reason}" class="text-muted">(<span
                                    th:text="${outcome.reason}">reason</span>)</span>
                        </div>

                        <!-- Display all penalty outcomes -->
                        <div th:each="outcome : ${rule.outcomes}" th:if="${outcome.type == 'penalty'}" class="mb-2">
                            <span class="badge bg-danger">Penalty</span>
                            <span th:text="${outcome.points}">0</span> points penalty to the
                            <span th:text="${outcome.target != null ? outcome.target : 'participant'}">target</span>'s
                            group.
                            <span th:if="${outcome.reason}" class="text-muted">(<span
                                    th:text="${outcome.reason}">reason</span>)</span>
                        </div>

                        <a th:href="@{'/rules/' + ${rule.ruleName.replace(' ', '-').toLowerCase()}}"
                           class="btn mt-3"
                           th:with="hasAward=${rule.outcomes.?[type == 'award'].size() > 0}, 
                                   hasPenalty=${rule.outcomes.?[type == 'penalty'].size() > 0}"
                           th:classappend="${hasAward && hasPenalty ? 'btn-outline-warning' : (hasAward ? 'btn-outline-success' : 'btn-outline-danger')}">
                            Execute Rule
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <h4>Rules Overview</h4>
            <p>The gamification system uses rules to award or penalize points based on various activities. Each rule has
                different effects and may be subject to caps or other limitations.</p>
            <p>When a rule is executed, points are awarded or deducted from the relevant person's group, and the
                person's contribution is recorded in the system.</p>
            <p>Some rules, like the SAP Hours rule, have weekly caps that reset automatically after 7 days.</p>
        </div>
    </div>
</section>
</body>
</html>